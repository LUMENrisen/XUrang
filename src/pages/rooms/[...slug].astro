---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const rooms = await getCollection('rooms');
  return rooms.map((room) => ({
    params: { slug: room.id },
    props: { room },
  }));
}

const { room } = Astro.props;
const { data } = room;

// 获取所有博客文章，筛选出 tags 包含当前房间标题的文章
const allPosts = await getCollection('blog');
const relatedPosts = allPosts.filter(post => 
  post.data.tags && post.data.tags.includes(data.title)
);
---

<Layout title={`${data.title} · 塔`}>
  <main style="max-width: 700px; margin: 0 auto; padding: 2rem 1rem;">
 <div style="text-align: center;">
    <div style="font-size: 3rem;">{data.icon}</div>
    <h1>{data.title}</h1>
    <p style="font-size: 1.2rem; color: #4b5563;">{data.subtitle}</p>
    <p>{data.description}</p>
    <hr />
    <h2>相关文章</h2>
    {relatedPosts.length === 0 ? (
      <p style="color: gray;">暂无相关文章，你可以写一篇关联到“{data.title}”。</p>
    ) : (
      <ul style="list-style: none; padding: 0;">
        {relatedPosts.map(post => (
          <li style="margin-bottom: 0.5rem;">
            <a href={`/blog/${post.id.replace(/\.md$/, '')}/`} style="text-decoration: none; color: var(--accent);">
              {post.data.title}
            </a>
            <span style="color: gray; margin-left: 0.5rem; font-size: 0.9rem;">
              {new Date(post.data.pubDate).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}
            </span>
          </li>
        ))}
      </ul>
    )}
  </main>
</Layout>