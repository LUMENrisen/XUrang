---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { identities } from '../../consts';

export async function getStaticPaths() {
  return identities.map(({ person }) => ({
    params: { slug: person },
    props: { personData: { person, roomTitle: identities.find(i => i.person === person)?.roomTitle } }
  }));
}

const { personData } = Astro.props;
const { person, roomTitle } = personData;

const allPosts = await getCollection('blog');
const relatedPosts = allPosts.filter(post => post.data.person === person);

const rooms = await getCollection('rooms');
const room = rooms.find(r => r.data.title === roomTitle);
---

<Layout title={`${person} Â· è·¯`}>
  <main style="max-width: 700px; margin: 0 auto; padding: 2rem 1rem;">


    <!-- å†…å®¹åŒºåŸŸå±…ä¸­ -->
    <div style="text-align: center;">
      <div style="font-size: 4rem;">ğŸ¦Œ</div>
      <h1>{person}</h1>

      {room && (
        <p style="display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
        
          <a href={`/rooms/${room.id}`} style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.5rem;">
            <span style="font-size: 1.8rem;">{room.data.icon}</span>
          </a>
        </p>
      )}

      <hr style="margin: 2rem auto; width: 100px; border: 0; border-top: 1px solid #ddd;" />

      <h2>ç›¸å…³æ–‡ç« </h2>
      {relatedPosts.length === 0 ? (
        <p style="color: gray;">æš‚æ— ç›¸å…³æ–‡ç« ï¼Œä½ å¯ä»¥å†™ä¸€ç¯‡å…³è”åˆ°â€œ{person}â€ã€‚</p>
      ) : (
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
          {relatedPosts.map(post => (
            <div key={post.id}>
              <a href={`/blog/${post.id.replace(/\.md$/, '')}/`} style="text-decoration: none; color: var(--accent);">
                {post.data.title}
              </a>
              <span style="color: gray; margin-left: 0.5rem; font-size: 0.9rem;">
                {new Date(post.data.pubDate).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}
              </span>
            </div>
          ))}
        </div>
      )}
    </div>
  </main>
</Layout>